import{useMemo as o,useRef as r,useCallback as t,useEffect as n,useState as e}from"react";const s=()=>"undefined"!=typeof window&&"EyeDropper"in window,c=()=>{throw new Error("Unsupported browser.")},i=()=>{const o=r(),[c,i]=e(!1);n(()=>(o.current=!0,i(s()),()=>{o.current=!1}),[]);const p=t(()=>c,[c]);return[o,p]},p=o=>{const r=(o=>s()&&new EyeDropper(o))(o);var t;return(t=r)?EyeDropper.prototype.open.bind(t):c},a=e=>{const s=o(()=>p(e),[e]),[c,a]=i(),w=r(),d=t(()=>{void 0!==w.current&&w.current.abort()},[w]),f=t(async function(o){void 0===o&&(o={}),d();const{signal:r,...t}=o,n=new AbortController;w.current=n;const e=void 0!==r?(o=>{const r=new AbortController,t=()=>{r.abort();for(const r of o)r.removeEventListener("abort",t)};for(const r of o){if(r.aborted){t();break}r.addEventListener("abort",t)}return r.signal})([r,n.signal]):n.signal;try{return await s({...t,signal:e})}catch(o){throw c.current||(o.canceled=!0),o}},[w,c,d,s]);return n(()=>d,[d]),{open:f,close:d,isSupported:a}};export{a as default};
